<!-- Jambiz Advent Calendar App -->

<div class="min-h-screen flex flex-col bg-gradient-to-b from-bg to-surface relative">
  <!-- Global Snowflakes -->
  <div class="fixed inset-0 pointer-events-none overflow-hidden z-0">
    @for (snowflake of snowflakes; track $index) {
    <div
      class="snowflake absolute text-white"
      [style.left.%]="snowflake.left"
      [style.top.px]="snowflake.startY"
      [style.animation-duration.s]="snowflake.animationDuration"
      [style.animation-delay.s]="snowflake.animationDelay"
      [style.font-size.px]="snowflake.fontSize"
      [style.opacity]="snowflake.opacity"
    >
      ‚ùÑ
    </div>
    }
  </div>

  @if (showLandingPage) {
  <!-- Language Toggle for Landing Page -->
  <div class="absolute top-4 right-4 z-20">
    <button
      (click)="toggleLanguage()"
      class="btn btn-outline text-sm px-3 py-2"
      [attr.aria-label]="'Switch to ' + (currentLanguage === 'sv' ? 'English' : 'Swedish')"
    >
      {{ currentLanguage === 'sv' ? 'EN' : 'SV' }}
    </button>
  </div>

  <app-landing-page
    (start)="startCalendar()"
    class="flex-1 flex items-center justify-center relative z-10"
  ></app-landing-page>
  } @else {
  <!-- Header -->
  <header class="bg-surface border-b-2 border-accent-red shadow-lg relative z-10">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-3 sm:py-4">
      <div class="flex items-center justify-between gap-4">
        <!-- Logo and Title -->
        <div class="flex items-center gap-3 sm:gap-4 flex-1">
          <div class="bg-white rounded-lg p-2 sm:p-2.5 shadow-md">
            <img
              src="assets/Jambiz_xmas_logo.png"
              alt="Jambiz Logo"
              class="h-12 w-20 sm:h-14 sm:w-24 lg:h-16 lg:w-32 object-contain"
            />
          </div>
          <div class="text-left">
            <h1 class="text-xl sm:text-2xl lg:text-3xl font-bold text-text leading-tight">
              {{ 'app.title' | translate }}
            </h1>
            <p class="text-xs sm:text-sm text-text-muted mt-0.5 sm:mt-1">
              {{ 'app.subtitle' | translate }}
            </p>
          </div>
        </div>

        <!-- Language Toggle - Single Button -->
        <button
          (click)="toggleLanguage()"
          class="btn btn-outline shrink-0 text-xs sm:text-sm px-2 sm:px-3 py-1.5 sm:py-2 min-w-[3rem] sm:min-w-[3.5rem]"
          [attr.aria-label]="'Switch to ' + (currentLanguage === 'sv' ? 'English' : 'Swedish')"
        >
          {{ currentLanguage === 'sv' ? 'EN' : 'SV' }}
        </button>

        <!-- Mark All Complete Button -->
        <button
          (click)="markAllComplete()"
          class="btn btn-secondary shrink-0 text-xs sm:text-sm px-2 sm:px-3 py-1.5 sm:py-2"
          [attr.aria-label]="'Mark all challenges as completed'"
          title="{{ 'admin.markAllComplete' | translate }}"
        >
          <lucide-icon
            [img]="CheckCheck"
            class="w-4 h-4 sm:w-5 sm:h-5"
            [strokeWidth]="2"
          ></lucide-icon>
        </button>

        <!-- Clear All Progress Button -->
        <button
          (click)="clearAllProgress()"
          class="btn btn-primary shrink-0 text-xs sm:text-sm px-2 sm:px-3 py-1.5 sm:py-2"
          [attr.aria-label]="'Clear all progress'"
          title="{{ 'admin.clearAll' | translate }}"
        >
          <lucide-icon
            [img]="XCircle"
            class="w-4 h-4 sm:w-5 sm:h-5"
            [strokeWidth]="2"
          ></lucide-icon>
        </button>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="flex-1 max-w-7xl w-full mx-auto px-4 sm:px-6 lg:px-8 py-8 relative z-10">
    <app-calendar></app-calendar>

    <!-- Extras Button -->
    <div class="mt-8 text-center">
      <button class="btn btn-secondary px-8 py-3 text-lg font-bold" (click)="openExtras()">
        üéÅ {{ 'extras.button' | translate }} üéÅ
      </button>
    </div>
  </main>
  }
</div>

<!-- Extras Menu Modal -->
@if (showExtrasMenu) {
<div class="modal-overlay" (click)="closeExtrasMenu()">
  <div
    class="modal-content w-full h-full lg:w-[90vw] lg:max-w-5xl lg:max-h-[90vh] lg:rounded-2xl flex flex-col overflow-hidden"
    (click)="$event.stopPropagation()"
  >
    <!-- Header -->
    <div class="flex items-center justify-between mb-6 flex-shrink-0">
      <div class="flex items-center gap-4">
        <h2 class="text-2xl sm:text-3xl font-bold text-text">
          üéÅ {{ 'extras.title' | translate }} üéÅ
        </h2>
      </div>
      <button (click)="closeExtrasMenu()" class="btn btn-outline p-2 min-w-0" aria-label="Close">
        <lucide-icon [img]="X" class="w-6 h-6" [strokeWidth]="2"></lucide-icon>
      </button>
    </div>

    <!-- Extras Content -->
    <div class="flex-1 overflow-y-auto">
      @if (!selectedGame) {
      <!-- Game Selection View -->
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
        @for (game of extraLevels; track game.type) {
        <button
          (click)="selectGame(game)"
          class="card p-6 text-left hover:bg-opacity-80 transition-all cursor-pointer"
          [class.border-2]="getCompletionCount(game).completed === getCompletionCount(game).total"
          [class.border-accent-green]="
            getCompletionCount(game).completed === getCompletionCount(game).total
          "
        >
          <div class="flex items-center justify-between">
            <div class="flex items-center gap-3">
              <span class="text-5xl">{{ getGameIcon(game.type) }}</span>
              <div>
                <h3 class="text-xl font-bold text-text">
                  {{ 'extras.games.' + game.type + '.title' | translate }}
                </h3>
                <p class="text-sm text-text-muted">
                  {{ getCompletionCount(game).completed }}/{{ getCompletionCount(game).total }}
                  {{ 'extras.levelsCompleted' | translate }}
                </p>
              </div>
            </div>
            @if (getCompletionCount(game).completed === getCompletionCount(game).total) {
            <lucide-icon
              [img]="Check"
              class="w-8 h-8 text-accent-green"
              [strokeWidth]="3"
            ></lucide-icon>
            }
          </div>
        </button>
        }
      </div>
      } @else {
      <!-- Level Selection View -->
      <div class="mb-6 pb-6 border-b border-surface flex items-center gap-4">
        <button
          (click)="backToGameSelection()"
          class="btn btn-outline p-2 min-w-0"
          aria-label="Back"
        >
          <lucide-icon [img]="ArrowLeft" class="w-6 h-6" [strokeWidth]="2"></lucide-icon>
        </button>

        <span class="text-6xl">{{ getGameIcon(selectedGame.type) }}</span>
        <div>
          <h3 class="text-2xl font-bold text-text mb-2">
            {{ 'extras.games.' + selectedGame.type + '.title' | translate }}
          </h3>
          <p class="text-text-muted">
            {{ getCompletionCount(selectedGame).completed }}/{{
              getCompletionCount(selectedGame).total
            }}
            {{ 'extras.levelsCompleted' | translate }}
          </p>
        </div>
      </div>

      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
        @for (level of selectedGame.levels; track level.id) {
        <button
          (click)="selectExtra(level)"
          class="card p-6 text-left hover:bg-opacity-80 transition-all"
          [class.border-2]="isExtraCompleted(level.id)"
          [class.border-accent-green]="isExtraCompleted(level.id)"
        >
          <div class="flex items-start justify-between mb-3">
            <h4 class="text-lg font-bold text-text">
              {{ level.nameKey | translate }}
            </h4>
            @if (isExtraCompleted(level.id)) {
            <lucide-icon
              [img]="Check"
              class="w-6 h-6 text-accent-green"
              [strokeWidth]="3"
            ></lucide-icon>
            }
          </div>
          <p class="text-sm text-text-muted">
            {{ level.descriptionKey | translate }}
          </p>
        </button>
        }
      </div>
      }
    </div>
  </div>
</div>
}

<!-- Extra Challenge Modal (using ChallengeHost) -->
@if (showExtraChallenge && selectedExtraConfig) {
<app-challenge-host
  [dayConfig]="selectedExtraConfig"
  [isCompleted]="selectedExtraId ? isExtraCompleted(selectedExtraId) : false"
  (close)="closeExtraChallenge()"
  (challengeCompleted)="onExtraChallengeCompleted()"
></app-challenge-host>
}
