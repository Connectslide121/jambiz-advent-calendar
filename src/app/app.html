<!-- Jambiz Advent Calendar App -->

<div class="min-h-screen flex flex-col bg-gradient-to-b from-bg to-surface relative">
  <!-- Global Snowflakes -->
  <div class="fixed inset-0 pointer-events-none overflow-hidden z-0">
    @for (snowflake of snowflakes; track $index) {
    <div
      class="snowflake absolute text-white"
      [style.left.%]="snowflake.left"
      [style.top.px]="snowflake.startY"
      [style.animation-duration.s]="snowflake.animationDuration"
      [style.animation-delay.s]="snowflake.animationDelay"
      [style.font-size.px]="snowflake.fontSize"
      [style.opacity]="snowflake.opacity"
    >
      ‚ùÑ
    </div>
    }
  </div>

  @if (showLandingPage) {
  <!-- Language Toggle for Landing Page -->
  <div class="absolute top-4 right-4 z-20">
    <button
      (click)="toggleLanguage()"
      class="btn btn-outline text-sm px-3 py-2"
      [attr.aria-label]="'Switch to ' + (currentLanguage === 'sv' ? 'English' : 'Swedish')"
    >
      {{ currentLanguage === 'sv' ? 'EN' : 'SV' }}
    </button>
  </div>

  <app-landing-page
    (start)="startCalendar()"
    (showInfo)="openInfoModal()"
    class="flex-1 flex items-center justify-center relative z-10"
  ></app-landing-page>
  } @else {
  <!-- Header -->
  <header class="bg-surface border-b-2 border-accent-red shadow-lg relative z-10">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-3 sm:py-4">
      <div class="flex items-center justify-between gap-4">
        <!-- Logo and Title -->
        <div class="flex items-center gap-3 sm:gap-4 flex-1">
          <div class="bg-white rounded-lg p-2 sm:p-2.5 shadow-md">
            <img
              src="assets/Jambiz_xmas_logo.png"
              alt="Jambiz Logo"
              class="h-12 w-20 sm:h-14 sm:w-24 lg:h-16 lg:w-32 object-contain"
            />
          </div>
          <div class="text-left">
            <h1 class="text-xl sm:text-2xl lg:text-3xl font-bold text-text leading-tight">
              {{ 'app.title' | translate }}
            </h1>
            <p class="text-xs sm:text-sm text-text-muted mt-0.5 sm:mt-1">
              {{ 'app.subtitle' | translate }}
            </p>
          </div>
        </div>

        <!-- Controls Container - wraps on mobile -->
        <div class="flex flex-wrap items-center gap-2 sm:gap-3 justify-end">
          <!-- Language Toggle - Single Button -->
          <button
            (click)="toggleLanguage()"
            class="btn btn-outline shrink-0 text-xs sm:text-sm px-2 sm:px-3 py-1.5 sm:py-2 min-w-[3rem] sm:min-w-[3.5rem]"
            [attr.aria-label]="'Switch to ' + (currentLanguage === 'sv' ? 'English' : 'Swedish')"
          >
            {{ currentLanguage === 'sv' ? 'EN' : 'SV' }}
          </button>

          <!-- Dev Mode Toggle Button -->
          <button
            (click)="calendarState.toggleDevMode()"
            class="btn shrink-0 text-xs sm:text-sm px-2 sm:px-3 py-1.5 sm:py-2"
            [class.btn-secondary]="calendarState.devMode"
            [class.btn-outline]="!calendarState.devMode"
            [attr.aria-label]="'Toggle developer mode'"
            title="Dev Mode: {{ calendarState.devMode ? 'ON' : 'OFF' }} (unlocks all days)"
          >
            <lucide-icon [img]="Code" class="w-4 h-4 sm:w-5 sm:h-5" [strokeWidth]="2"></lucide-icon>
          </button>

          <!-- Date Override Input (for testing) -->
          <div class="flex items-center gap-1">
            <input
              type="number"
              min="1"
              max="31"
              [value]="calendarState.dateOverride ?? ''"
              (input)="onDateOverrideChange($event)"
              placeholder="Day"
              class="w-14 px-2 py-1.5 text-xs sm:text-sm bg-surface border border-border rounded text-text text-center"
              title="Set fake December day (1-31) for testing"
            />
            @if (calendarState.dateOverride !== null) {
            <button
              (click)="calendarState.dateOverride = null"
              class="btn btn-outline p-1 min-w-0"
              title="Clear date override"
            >
              <lucide-icon [img]="X" class="w-3 h-3" [strokeWidth]="2"></lucide-icon>
            </button>
            }
          </div>

          <!-- Mark All Complete Button -->
          <button
            (click)="markAllComplete()"
            class="btn btn-secondary shrink-0 text-xs sm:text-sm px-2 sm:px-3 py-1.5 sm:py-2"
            [attr.aria-label]="'Mark all challenges as completed'"
            title="{{ 'admin.markAllComplete' | translate }}"
          >
            <lucide-icon
              [img]="CheckCheck"
              class="w-4 h-4 sm:w-5 sm:h-5"
              [strokeWidth]="2"
            ></lucide-icon>
          </button>

          <!-- Clear All Progress Button -->
          <button
            (click)="clearAllProgress()"
            class="btn btn-primary shrink-0 text-xs sm:text-sm px-2 sm:px-3 py-1.5 sm:py-2"
            [attr.aria-label]="'Clear all progress'"
            title="{{ 'admin.clearAll' | translate }}"
          >
            <lucide-icon
              [img]="XCircle"
              class="w-4 h-4 sm:w-5 sm:h-5"
              [strokeWidth]="2"
            ></lucide-icon>
          </button>
        </div>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="flex-1 max-w-6xl w-full mx-auto px-4 sm:px-6 lg:px-8 py-8 relative z-10">
    <!-- Info Button -->
    <div class="flex justify-center mb-6">
      <button
        (click)="openInfoModal()"
        class="btn btn-outline px-4 py-2 text-sm sm:text-base flex items-center gap-2"
      >
        <lucide-icon [img]="Info" class="w-4 h-4 sm:w-5 sm:h-5" [strokeWidth]="2"></lucide-icon>
        {{ 'info.button' | translate }}
      </button>
    </div>

    <app-calendar
      (openRewardsGallery)="openRewardsGallery()"
      (openExtras)="openExtras()"
      (calendarComplete)="onCalendarComplete()"
    ></app-calendar>
  </main>
  }
</div>

<!-- Extras Menu Modal -->
@if (showExtrasMenu) {
<div class="modal-overlay" (click)="closeExtrasMenu()">
  <div
    class="modal-content w-full h-full lg:w-[90vw] lg:max-w-5xl lg:max-h-[90vh] lg:rounded-2xl flex flex-col overflow-hidden"
    (click)="$event.stopPropagation()"
  >
    <!-- Header -->
    <div class="flex items-center justify-between mb-6 flex-shrink-0">
      <div class="flex items-center gap-4">
        <h2 class="text-2xl sm:text-3xl font-bold text-text">
          üéÅ {{ 'extras.title' | translate }} üéÅ
        </h2>
      </div>
      <button (click)="closeExtrasMenu()" class="btn btn-outline p-2 min-w-0" aria-label="Close">
        <lucide-icon [img]="X" class="w-6 h-6" [strokeWidth]="2"></lucide-icon>
      </button>
    </div>

    <!-- Extras Content -->
    <div class="flex-1 overflow-y-auto">
      @if (!selectedGame) {
      <!-- Game Selection View -->
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
        @for (game of extraLevels; track game.type) {
        <button
          (click)="selectGame(game)"
          class="card p-6 text-left hover:bg-opacity-80 transition-all cursor-pointer"
          [class.border-2]="getCompletionCount(game).completed === getCompletionCount(game).total"
          [class.border-accent-green]="
            getCompletionCount(game).completed === getCompletionCount(game).total
          "
        >
          <div class="flex items-center justify-between">
            <div class="flex items-center gap-3">
              <span class="text-5xl">{{ getGameIcon(game.type) }}</span>
              <div>
                <h3 class="text-xl font-bold text-text">
                  {{ 'extras.games.' + game.type + '.title' | translate }}
                </h3>
                <p class="text-sm text-text-muted">
                  {{ getCompletionCount(game).completed }}/{{ getCompletionCount(game).total }}
                  {{ 'extras.levelsCompleted' | translate }}
                </p>
              </div>
            </div>
            @if (getCompletionCount(game).completed === getCompletionCount(game).total) {
            <lucide-icon
              [img]="Check"
              class="w-8 h-8 text-accent-green"
              [strokeWidth]="3"
            ></lucide-icon>
            }
          </div>
        </button>
        }
      </div>
      } @else {
      <!-- Level Selection View -->
      <div class="mb-6 pb-6 border-b border-surface flex items-center gap-4">
        <button
          (click)="backToGameSelection()"
          class="btn btn-outline p-2 min-w-0"
          aria-label="Back"
        >
          <lucide-icon [img]="ArrowLeft" class="w-6 h-6" [strokeWidth]="2"></lucide-icon>
        </button>

        <span class="text-6xl">{{ getGameIcon(selectedGame.type) }}</span>
        <div>
          <h3 class="text-2xl font-bold text-text mb-2">
            {{ 'extras.games.' + selectedGame.type + '.title' | translate }}
          </h3>
          <p class="text-text-muted">
            {{ getCompletionCount(selectedGame).completed }}/{{
              getCompletionCount(selectedGame).total
            }}
            {{ 'extras.levelsCompleted' | translate }}
          </p>
        </div>
      </div>

      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
        @for (level of selectedGame.levels; track level.id) {
        <button
          (click)="selectExtra(level)"
          class="card p-6 text-left hover:bg-opacity-80 transition-all"
          [class.border-2]="isExtraCompleted(level.id)"
          [class.border-accent-green]="isExtraCompleted(level.id)"
        >
          <div class="flex items-start justify-between mb-3">
            <h4 class="text-lg font-bold text-text">
              {{ level.nameKey | translate }}
            </h4>
            @if (isExtraCompleted(level.id)) {
            <lucide-icon
              [img]="Check"
              class="w-6 h-6 text-accent-green"
              [strokeWidth]="3"
            ></lucide-icon>
            }
          </div>
          <p class="text-sm text-text-muted">
            {{ level.descriptionKey | translate }}
          </p>
        </button>
        }
      </div>
      }
    </div>
  </div>
</div>
}

<!-- Extra Challenge Modal (using ChallengeHost) -->
@if (showExtraChallenge && selectedExtraConfig) {
<app-challenge-host
  [dayConfig]="selectedExtraConfig"
  [isCompleted]="selectedExtraId ? isExtraCompleted(selectedExtraId) : false"
  (close)="closeExtraChallenge()"
  (challengeCompleted)="onExtraChallengeCompleted()"
></app-challenge-host>
}

<!-- Info Modal -->
@if (showInfoModal) {
<div class="modal-overlay" (click)="closeInfoModal()">
  <div
    class="modal-content w-full h-full lg:w-[90vw] lg:max-w-3xl lg:max-h-[90vh] lg:rounded-2xl flex flex-col overflow-hidden"
    (click)="$event.stopPropagation()"
  >
    <!-- Header -->
    <div class="flex items-center justify-between mb-6 flex-shrink-0">
      <div class="flex items-center gap-3">
        <lucide-icon [img]="Info" class="w-7 h-7 text-accent-green" [strokeWidth]="2"></lucide-icon>
        <h2 class="text-xl sm:text-2xl font-bold text-text">
          {{ 'info.title' | translate }}
        </h2>
      </div>
      <button (click)="closeInfoModal()" class="btn btn-outline p-2 min-w-0" aria-label="Close">
        <lucide-icon [img]="X" class="w-6 h-6" [strokeWidth]="2"></lucide-icon>
      </button>
    </div>

    <!-- Content -->
    <div class="flex-1 overflow-y-auto space-y-6 pr-2">
      <!-- Welcome -->
      <div class="card p-4 sm:p-5">
        <h3 class="text-lg font-bold text-gold mb-2">
          {{ 'info.sections.welcome.title' | translate }}
        </h3>
        <p class="text-text-muted text-sm sm:text-base leading-relaxed">
          {{ 'info.sections.welcome.content' | translate }}
        </p>
      </div>

      <!-- Unlocking -->
      <div class="card p-4 sm:p-5">
        <h3 class="text-lg font-bold text-gold mb-2">
          {{ 'info.sections.unlocking.title' | translate }}
        </h3>
        <p class="text-text-muted text-sm sm:text-base leading-relaxed">
          {{ 'info.sections.unlocking.content' | translate }}
        </p>
      </div>

      <!-- Challenges -->
      <div class="card p-4 sm:p-5">
        <h3 class="text-lg font-bold text-gold mb-2">
          {{ 'info.sections.challenges.title' | translate }}
        </h3>
        <p class="text-text-muted text-sm sm:text-base leading-relaxed">
          {{ 'info.sections.challenges.content' | translate }}
        </p>
      </div>

      <!-- Rewards -->
      <div class="card p-4 sm:p-5">
        <h3 class="text-lg font-bold text-gold mb-2">
          {{ 'info.sections.rewards.title' | translate }}
        </h3>
        <p class="text-text-muted text-sm sm:text-base leading-relaxed">
          {{ 'info.sections.rewards.content' | translate }}
        </p>
      </div>

      <!-- Replay -->
      <div class="card p-4 sm:p-5">
        <h3 class="text-lg font-bold text-gold mb-2">
          {{ 'info.sections.replay.title' | translate }}
        </h3>
        <p class="text-text-muted text-sm sm:text-base leading-relaxed">
          {{ 'info.sections.replay.content' | translate }}
        </p>
      </div>

      <!-- Christmas -->
      <div class="card p-4 sm:p-5 border-2 border-accent-green">
        <h3 class="text-lg font-bold text-accent-green mb-2">
          {{ 'info.sections.christmas.title' | translate }}
        </h3>
        <p class="text-text-muted text-sm sm:text-base leading-relaxed">
          {{ 'info.sections.christmas.content' | translate }}
        </p>
      </div>

      <!-- Extras -->
      <div class="card p-4 sm:p-5">
        <h3 class="text-lg font-bold text-gold mb-2">
          {{ 'info.sections.extras.title' | translate }}
        </h3>
        <p class="text-text-muted text-sm sm:text-base leading-relaxed">
          {{ 'info.sections.extras.content' | translate }}
        </p>
      </div>

      <!-- Pro Tip -->
      <div
        class="card p-4 sm:p-5 bg-opacity-50"
        style="
          background: linear-gradient(135deg, rgba(244, 211, 94, 0.1), rgba(42, 157, 143, 0.1));
        "
      >
        <h3 class="text-lg font-bold text-gold mb-2">
          {{ 'info.sections.tip.title' | translate }}
        </h3>
        <p class="text-text-muted text-sm sm:text-base leading-relaxed">
          {{ 'info.sections.tip.content' | translate }}
        </p>
      </div>

      <!-- Closing -->
      <div class="text-center py-4">
        <p class="text-text text-base sm:text-lg font-medium">{{ 'info.closing' | translate }}</p>
      </div>
    </div>
  </div>
</div>
}

<!-- Rewards Gallery Modal -->
@if (showRewardsGallery) {
<div class="modal-overlay" (click)="closeRewardsGallery()">
  <div
    class="modal-content w-full h-full lg:w-[90vw] lg:max-w-5xl lg:max-h-[90vh] lg:rounded-2xl flex flex-col overflow-hidden"
    (click)="$event.stopPropagation()"
  >
    <!-- Header -->
    <div class="flex items-center justify-between mb-6 flex-shrink-0">
      <div class="flex items-center gap-4">
        <h2 class="text-2xl sm:text-3xl font-bold text-text">
          üèÜ {{ 'rewards.galleryTitle' | translate }} üèÜ
        </h2>
      </div>
      <button
        (click)="closeRewardsGallery()"
        class="btn btn-outline p-2 min-w-0"
        aria-label="Close"
      >
        <lucide-icon [img]="X" class="w-6 h-6" [strokeWidth]="2"></lucide-icon>
      </button>
    </div>

    <!-- Rewards List -->
    <div class="flex-1 overflow-y-auto">
      <div class="space-y-4">
        @for (day of getSortedCalendarDays(); track day.day) {
        <div class="card p-4 sm:p-6">
          <div class="flex items-start gap-4">
            <!-- Day Badge -->
            <div
              class="flex-shrink-0 w-12 h-12 sm:w-16 sm:h-16 rounded-full bg-accent-red flex items-center justify-center"
            >
              <span class="text-lg sm:text-2xl font-bold text-white">{{ day.day }}</span>
            </div>

            <!-- Reward Content -->
            <div class="flex-1 min-w-0">
              <div class="flex items-center gap-2 mb-2">
                <span class="text-2xl">{{ getGameIcon(day.challengeType || '') }}</span>
                <h3 class="text-lg sm:text-xl font-bold text-gold">
                  {{ 'calendar.dayLabel' | translate : { day: day.day } }}
                </h3>
                @if (hasVideoReward(day)) {
                <span class="text-sm bg-accent-green text-white px-2 py-0.5 rounded-full"
                  >üé¨ Video</span
                >
                } @if (hasAudioReward(day)) {
                <span class="text-sm bg-gold text-bg px-2 py-0.5 rounded-full">üéµ Audio</span>
                } @if (hasCouponReward(day)) {
                <span class="text-sm bg-white text-accent-red px-2 py-0.5 rounded-full"
                  >üéüÔ∏è Coupon</span
                >
                } @if (hasSnowGlobeReward(day)) {
                <span class="text-sm bg-blue-500 text-white px-2 py-0.5 rounded-full"
                  >üîÆ Snow Globe</span
                >
                } @if (hasMagic8BallReward(day)) {
                <span class="text-sm bg-purple-600 text-white px-2 py-0.5 rounded-full"
                  >üé± Magic 8-Ball</span
                >
                } @if (hasPopupCardReward(day)) {
                <span class="text-sm bg-red-600 text-white px-2 py-0.5 rounded-full"
                  >üíå Pop-up Card</span
                >
                } @if (hasFortuneCookieReward(day)) {
                <span class="text-sm bg-amber-500 text-white px-2 py-0.5 rounded-full"
                  >ü•† Fortune Cookie</span
                >
                }
              </div>

              <!-- Fun Fact / Text Reward -->
              @if (getRewardText(day)) {
              <p class="text-sm sm:text-base text-text leading-relaxed">
                {{ getRewardText(day) | translate }}
              </p>
              }

              <!-- Video Reward -->
              @if (hasVideoReward(day) && day.reward?.videoUrl) {
              <div class="mt-4">
                <video
                  [src]="day.reward!.videoUrl"
                  controls
                  class="max-w-full h-auto rounded-lg shadow-lg"
                  style="max-height: 200px"
                  playsinline
                >
                  <source
                    [src]="day.reward!.videoUrl!"
                    [type]="'video/' + (day.reward!.videoType || 'mp4')"
                  />
                </video>
              </div>
              }

              <!-- Audio Reward -->
              @if (hasAudioReward(day) && day.reward?.audioUrl) {
              <div class="mt-4 space-y-3">
                <div
                  class="flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-3 bg-surface rounded-lg p-3"
                >
                  @if (day.reward?.title) {
                  <span class="text-sm sm:text-base font-semibold text-gold">
                    {{ day.reward!.title | translate }}
                  </span>
                  }
                  <audio [src]="day.reward!.audioUrl" controls class="w-full sm:flex-1 h-10">
                    <source
                      [src]="day.reward!.audioUrl!"
                      [type]="'audio/' + (day.reward!.audioType || 'mp3')"
                    />
                  </audio>
                </div>
                @if (day.reward?.lyrics) {
                <details class="bg-surface rounded-lg">
                  <summary
                    class="cursor-pointer p-3 text-gold font-semibold flex items-center gap-2"
                  >
                    <span>üìù</span>
                    <span>{{ 'rewards.lyricsLabel' | translate }}</span>
                  </summary>
                  <pre
                    class="p-3 pt-0 text-sm text-text whitespace-pre-wrap font-sans leading-relaxed"
                    >{{ day.reward!.lyrics | translate }}</pre
                  >
                </details>
                }
              </div>
              }

              <!-- Coupon Reward -->
              @if (hasCouponReward(day) && day.reward?.couponTitleKey) {
              <div class="mt-4">
                <button
                  (click)="openInteractiveReward(day)"
                  class="w-full flex items-center gap-3 bg-surface hover:bg-opacity-80 rounded-lg p-4 transition-all cursor-pointer border-2 border-transparent hover:border-accent-red"
                >
                  <span class="text-3xl sm:text-4xl">{{ day.reward!.couponEmoji || 'üéüÔ∏è' }}</span>
                  <div class="flex-1 min-w-0 text-left">
                    <h4 class="text-base sm:text-lg font-bold text-gold">
                      {{ day.reward!.couponTitleKey | translate }}
                    </h4>
                    <p class="text-xs sm:text-sm text-text-muted">
                      {{ 'rewards.gallery.clickToInteract' | translate }}
                    </p>
                  </div>
                </button>
              </div>
              }

              <!-- Snow Globe Reward -->
              @if (hasSnowGlobeReward(day)) {
              <div class="mt-4">
                <button
                  (click)="openInteractiveReward(day)"
                  class="w-full flex items-center gap-3 bg-surface hover:bg-opacity-80 rounded-lg p-4 transition-all cursor-pointer border-2 border-transparent hover:border-blue-500"
                >
                  <span class="text-4xl">üîÆ</span>
                  <div class="text-left">
                    <h4 class="text-base sm:text-lg font-bold text-gold">
                      {{ 'rewards.snowGlobe.title' | translate }}
                    </h4>
                    <p class="text-xs sm:text-sm text-text-muted">
                      {{ 'rewards.gallery.clickToInteract' | translate }}
                    </p>
                  </div>
                </button>
              </div>
              }

              <!-- Magic 8-Ball Reward -->
              @if (hasMagic8BallReward(day)) {
              <div class="mt-4">
                <button
                  (click)="openInteractiveReward(day)"
                  class="w-full flex items-center gap-3 bg-surface hover:bg-opacity-80 rounded-lg p-4 transition-all cursor-pointer border-2 border-transparent hover:border-purple-500"
                >
                  <span class="text-4xl">üé±</span>
                  <div class="text-left">
                    <h4 class="text-base sm:text-lg font-bold text-gold">
                      {{ 'rewards.magic8Ball.title' | translate }}
                    </h4>
                    <p class="text-xs sm:text-sm text-text-muted">
                      {{ 'rewards.gallery.clickToInteract' | translate }}
                    </p>
                  </div>
                </button>
              </div>
              }

              <!-- Pop-up Card Reward -->
              @if (hasPopupCardReward(day)) {
              <div class="mt-4">
                <button
                  (click)="openInteractiveReward(day)"
                  class="w-full flex items-center gap-3 bg-surface hover:bg-opacity-80 rounded-lg p-4 transition-all cursor-pointer border-2 border-transparent hover:border-red-500"
                >
                  <span class="text-4xl">üíå</span>
                  <div class="text-left">
                    <h4 class="text-base sm:text-lg font-bold text-gold">
                      {{ 'rewards.popupCard.title' | translate }}
                    </h4>
                    <p class="text-xs sm:text-sm text-text-muted">
                      {{ 'rewards.gallery.clickToInteract' | translate }}
                    </p>
                  </div>
                </button>
              </div>
              }

              <!-- Fortune Cookie Reward -->
              @if (hasFortuneCookieReward(day)) {
              <div class="mt-4">
                <button
                  (click)="openInteractiveReward(day)"
                  class="w-full flex items-center gap-3 bg-surface hover:bg-opacity-80 rounded-lg p-4 transition-all cursor-pointer border-2 border-transparent hover:border-amber-500"
                >
                  <span class="text-4xl">ü•†</span>
                  <div class="text-left">
                    <h4 class="text-base sm:text-lg font-bold text-gold">
                      {{ 'rewards.fortuneCookie.title' | translate }}
                    </h4>
                    <p class="text-xs sm:text-sm text-text-muted">
                      {{ 'rewards.gallery.clickToInteract' | translate }}
                    </p>
                  </div>
                </button>
              </div>
              }
            </div>
          </div>
        </div>
        }

        <!-- Day 25 - Completed Puzzle Image -->
        <div class="card p-4 sm:p-6 border-2 border-gold">
          <div class="flex flex-col items-center gap-4">
            <!-- Day Badge -->
            <div
              class="flex-shrink-0 w-16 h-16 sm:w-20 sm:h-20 rounded-full bg-gold flex items-center justify-center"
            >
              <span class="text-2xl sm:text-3xl font-bold text-bg">25</span>
            </div>

            <!-- Content -->
            <div class="text-center">
              <div class="flex items-center justify-center gap-2 mb-3">
                <span class="text-3xl">üéÑ</span>
                <h3 class="text-xl sm:text-2xl font-bold text-gold">
                  {{ 'rewards.puzzleComplete.title' | translate }}
                </h3>
                <span class="text-3xl">üéÑ</span>
              </div>
              <p class="text-sm sm:text-base text-text-muted mb-4">
                {{ 'rewards.puzzleComplete.description' | translate }}
              </p>
            </div>

            <!-- Puzzle Image -->
            <div class="w-full max-w-md">
              <img
                src="assets/Calendar_puzzle.png"
                alt="Completed Advent Calendar Puzzle"
                class="w-full h-auto rounded-lg shadow-lg border-2 border-gold"
              />
            </div>

            <!-- Download Button -->
            <a
              href="assets/Calendar_puzzle.png"
              download="Jambiz_Advent_Calendar_2025.png"
              class="btn btn-primary flex items-center gap-2 mt-4"
            >
              <span>üì•</span>
              {{ 'rewards.puzzleComplete.download' | translate }}
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
}

<!-- Interactive Reward Modal (Snow Globe / Magic 8-Ball) -->
@if (showInteractiveReward && interactiveRewardConfig) {
<div class="modal-overlay" (click)="closeInteractiveReward()">
  <div
    class="modal-content w-full h-full sm:w-[90vw] sm:max-w-2xl sm:h-auto sm:max-h-[90vh] sm:rounded-2xl flex flex-col p-8 relative overflow-y-auto"
    (click)="$event.stopPropagation()"
  >
    <!-- Close Button -->
    <button
      (click)="closeInteractiveReward()"
      class="absolute top-4 right-4 btn btn-outline p-2 min-w-0 z-10"
      aria-label="Close"
    >
      <lucide-icon [img]="X" class="w-6 h-6" [strokeWidth]="2"></lucide-icon>
    </button>

    <!-- Interactive Reward Component -->
    <div class="flex-1 flex items-center justify-center">
      <app-fun-fact-reveal
        [reward]="interactiveRewardConfig"
        (continue)="closeInteractiveReward()"
      ></app-fun-fact-reveal>
    </div>
  </div>
</div>
}

<!-- Celebration Modal - All 24 Days Complete -->
@if (showCelebration) {
<div class="modal-overlay celebration-overlay" (click)="closeCelebration()">
  <!-- Confetti animation -->
  <div class="confetti-container">
    @for (i of [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30];
    track i) {
    <div class="confetti" [style.--i]="i"></div>
    }
  </div>

  <div
    class="modal-content celebration-modal w-[95vw] max-w-lg p-6 sm:p-8 rounded-2xl text-center relative overflow-hidden"
    (click)="$event.stopPropagation()"
  >
    <!-- Decorative background -->
    <div
      class="absolute inset-0 bg-gradient-to-br from-accent-red/20 via-surface to-accent-green/20 -z-10"
    ></div>

    <!-- Close Button -->
    <button
      (click)="closeCelebration()"
      class="absolute top-3 right-3 btn btn-outline p-2 min-w-0"
      aria-label="Close"
    >
      <lucide-icon [img]="X" class="w-5 h-5" [strokeWidth]="2"></lucide-icon>
    </button>

    <!-- Trophy and Stars -->
    <div class="text-6xl sm:text-7xl mb-4 animate-bounce">üèÜ</div>
    <div class="text-3xl sm:text-4xl mb-6 flex justify-center gap-2">
      <span class="animate-pulse" style="animation-delay: 0s">‚≠ê</span>
      <span class="animate-pulse" style="animation-delay: 0.2s">üåü</span>
      <span class="animate-pulse" style="animation-delay: 0.4s">‚≠ê</span>
    </div>

    <!-- Title -->
    <h2 class="text-2xl sm:text-3xl font-bold text-gold mb-3">
      {{ 'celebration.title' | translate }}
    </h2>

    <!-- Message -->
    <p class="text-base sm:text-lg text-text mb-6">
      {{ 'celebration.message' | translate }}
    </p>

    <!-- Unlocked Features -->
    <div class="bg-surface/50 rounded-xl p-4 mb-6">
      <p class="text-sm sm:text-base text-accent-green font-semibold mb-3">
        {{ 'celebration.unlocked' | translate }}
      </p>
      <div class="flex justify-center gap-4 text-2xl">
        <span title="All Rewards">üéÅ</span>
        <span title="Extra Games">üéÆ</span>
        <span title="Puzzle Complete">üß©</span>
      </div>
    </div>

    <!-- Action Buttons -->
    <div class="flex flex-col sm:flex-row gap-3 justify-center">
      <button class="btn btn-primary px-6 py-3" (click)="closeCelebration(); openRewardsGallery()">
        üèÜ {{ 'celebration.viewRewards' | translate }}
      </button>
      <button class="btn btn-outline px-6 py-3" (click)="closeCelebration(); openExtras()">
        üéÆ {{ 'celebration.playExtras' | translate }}
      </button>
    </div>
  </div>
</div>
}
