<div class="text-center py-8 sm:py-12">
  <!-- Celebration Icon -->
  <div class="mb-6 animate-bounce">
    <div class="text-6xl sm:text-7xl lg:text-8xl">üéâ</div>
  </div>

  <!-- Success Message -->
  <h3 class="text-2xl sm:text-3xl font-bold text-accent-green mb-6">
    {{ 'challenges.success.title' | translate }}
  </h3>

  <!-- Reward Label -->
  <p class="text-lg sm:text-xl text-gold font-semibold mb-4">
    @if (effectiveReward && effectiveReward.title) {
    {{ effectiveReward.title | translate }}
    } @else {
    {{ 'challenges.success.funFactLabel' | translate }}
    }
  </p>

  <!-- Reward Content -->
  <div class="max-w-2xl mx-auto mb-8 px-4">
    @if (effectiveReward) {
    <!-- Text Reward -->
    @if (rewardType === 'text' && effectiveReward.textKey) {
    <p class="text-base sm:text-lg text-text leading-relaxed">
      {{ effectiveReward.textKey | translate }}
    </p>
    }

    <!-- Image Reward -->
    @if (rewardType === 'image' && effectiveReward.imageUrl) {
    <div class="reward-image-container">
      <img
        [src]="effectiveReward.imageUrl"
        [alt]="effectiveReward.imageAlt ? (effectiveReward.imageAlt | translate) : 'Reward image'"
        class="reward-image max-w-full h-auto rounded-lg shadow-lg mx-auto"
        loading="lazy"
      />
      @if (effectiveReward.caption) {
      <p class="text-sm sm:text-base text-text-muted mt-4 italic">
        {{ effectiveReward.caption | translate }}
      </p>
      }
    </div>
    }

    <!-- Video Reward -->
    @if (rewardType === 'video' && effectiveReward.videoUrl) {
    <div class="reward-video-container">
      <!-- Embedded Video (YouTube/Vimeo) -->
      @if (isEmbeddedVideo() && safeVideoUrl) {
      <div class="video-wrapper relative w-full" style="padding-bottom: 56.25%">
        <iframe
          [src]="safeVideoUrl"
          class="absolute top-0 left-0 w-full h-full rounded-lg shadow-lg"
          frameborder="0"
          allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
          allowfullscreen
        ></iframe>
      </div>
      }

      <!-- Native Video (mp4/webm) -->
      @if (!isEmbeddedVideo()) {
      <video
        [src]="effectiveReward.videoUrl"
        [poster]="effectiveReward.videoPoster || ''"
        controls
        class="max-w-full h-auto rounded-lg shadow-lg mx-auto"
        playsinline
      >
        <source
          [src]="effectiveReward.videoUrl"
          [type]="'video/' + (effectiveReward.videoType || 'mp4')"
        />
        Your browser does not support the video tag.
      </video>
      } @if (effectiveReward.videoCaption) {
      <p class="text-sm sm:text-base text-text-muted mt-4 italic">
        {{ effectiveReward.videoCaption | translate }}
      </p>
      }
    </div>
    }

    <!-- Audio Reward with Lyrics -->
    @if (rewardType === 'audio' && effectiveReward.audioUrl) {
    <div class="reward-audio-container space-y-3 text-left">
      <!-- Audio Player -->
      <div class="flex items-center gap-3 bg-surface rounded-lg p-3">
        <span class="text-2xl">üéµ</span>
        <audio [src]="effectiveReward.audioUrl" controls class="flex-1 h-10">
          <source
            [src]="effectiveReward.audioUrl"
            [type]="'audio/' + (effectiveReward.audioType || 'mp3')"
          />
          Your browser does not support the audio element.
        </audio>
        <span class="text-2xl">üéµ</span>
      </div>

      <!-- Lyrics Display (Expandable) -->
      @if (effectiveReward.lyrics) {
      <details class="bg-surface rounded-lg">
        <summary class="cursor-pointer p-3 text-gold font-semibold flex items-center gap-2">
          <span>üìù</span>
          <span>{{ 'rewards.lyricsLabel' | translate }}</span>
        </summary>
        <pre
          class="p-3 pt-0 text-sm text-text whitespace-pre-wrap font-sans leading-relaxed max-h-60 overflow-y-auto"
          >{{ effectiveReward.lyrics | translate }}</pre
        >
      </details>
      }
    </div>
    }

    <!-- Coupon Reward -->
    @if (rewardType === 'coupon' && effectiveReward.couponTitleKey) {
    <div class="coupon-container">
      <div class="coupon">
        <!-- Decorative top edge -->
        <div class="coupon-edge coupon-edge-top"></div>

        <!-- Coupon content -->
        <div class="coupon-content">
          <!-- Emoji -->
          <div class="text-5xl sm:text-6xl mb-4">
            {{ effectiveReward.couponEmoji || 'üéüÔ∏è' }}
          </div>

          <!-- Title -->
          <h4 class="text-xl sm:text-2xl font-bold text-gold mb-3">
            {{ effectiveReward.couponTitleKey | translate }}
          </h4>

          <!-- Description -->
          <p class="text-sm sm:text-base text-text leading-relaxed mb-4 italic">
            "{{ effectiveReward.couponDescriptionKey | translate }}"
          </p>

          <!-- Validity -->
          <div class="text-xs sm:text-sm text-text-muted">
            {{
              effectiveReward.couponValidityKey
                ? (effectiveReward.couponValidityKey | translate)
                : ('rewards.coupon.defaultValidity' | translate)
            }}
          </div>
        </div>

        <!-- Decorative bottom edge -->
        <div class="coupon-edge coupon-edge-bottom"></div>
      </div>

      <!-- Instruction -->
      <p class="text-xs sm:text-sm text-text-muted mt-4">
        {{ 'rewards.coupon.instruction' | translate }}
      </p>
    </div>
    }

    <!-- Snow Globe Reward -->
    @if (rewardType === 'snowGlobe') {
    <div class="snow-globe-card">
      <div class="snow-globe-container cursor-pointer" (click)="shakeSnowGlobe()">
        <div
          class="snow-globe"
          [class.shaking]="isShakingSnowGlobe"
          [class.falling]="isSnowFalling"
        >
          <div class="dome">
            <div class="scene">
              <div class="tree">üéÑ</div>
              <div class="snowman">‚õÑ</div>
            </div>
            @for (flake of snowflakes; track flake.id) {
            <div
              class="snowflake"
              [class.spawned]="flake.top < 0"
              [style.left.%]="flake.left"
              [style.top.%]="flake.top"
              [style.width.px]="flake.size"
              [style.height.px]="flake.size"
              [style.--fall-duration.s]="flake.speed"
              [style.--fall-delay.s]="flake.delay"
              [style.--chaos-x.px]="flake.chaosX"
              [style.--chaos-y.px]="flake.chaosY"
            ></div>
            }
          </div>
          <div class="base">
            <div class="plaque">
              <img src="assets/Jambiz_xmas_logo.png" alt="Jambiz" class="plaque-logo" />
              <span class="plaque-year">2025</span>
            </div>
          </div>
        </div>
      </div>
      <p class="text-sm text-text-muted mt-4 animate-pulse text-center">
        {{ 'rewards.snowGlobe.instruction' | translate }}
      </p>
    </div>
    }

    <!-- Magic 8-Ball Reward -->
    @if (rewardType === 'magic8Ball') {
    <div class="magic-8ball-card">
      <div class="magic-8ball-container cursor-pointer" (click)="shake8Ball()">
        <div class="magic-8ball" [class.shaking]="isShaking8Ball">
          <div class="shine"></div>
          <div class="window">
            <div class="triangle" [class.visible]="showEightBallAnswer">
              @if (eightBallAnswer) {
              <span class="answer">{{ eightBallAnswer | translate }}</span>
              }
            </div>
            @if (!showEightBallAnswer && !isShaking8Ball) {
            <div class="number-8">8</div>
            }
          </div>
        </div>
      </div>
      <p class="text-sm text-text-muted mt-4 animate-pulse text-center">
        {{ 'rewards.magic8Ball.instruction' | translate }}
      </p>
    </div>
    } }
  </div>

  <!-- Continue Button -->
  <button class="btn btn-primary text-base sm:text-lg px-6 py-3" (click)="onContinue()">
    {{ 'ui.continue' | translate }}
  </button>
</div>
