<div class="challenge-container flex flex-col h-full max-w-4xl mx-auto p-4 relative">
  <app-challenge-info-modal [show]="showInstructions" (start)="startGame()">
    <div class="text-center space-y-6">
      <div class="inline-block p-4 rounded-full bg-primary/10 mb-2">
        <div class="text-6xl animate-bounce">üéÅ</div>
      </div>

      <div class="space-y-4 text-text-muted">
        <p class="text-lg">
          {{ 'challenges.giftCatcher.instruction' | translate }}
        </p>
        <!-- Desktop instructions (hidden on mobile) -->
        <div
          class="hidden sm:block p-4 rounded-lg bg-surface border border-border text-left max-w-md mx-auto mt-6"
        >
          <div class="font-bold text-primary mb-1 flex items-center gap-2">
            <lucide-icon [img]="Keyboard" class="w-4 h-4"></lucide-icon>
            {{ 'challenges.giftCatcher.controlsDesktop' | translate }}
          </div>
        </div>

        <!-- Mobile instructions (hidden on desktop) -->
        <div
          class="sm:hidden p-4 rounded-lg bg-surface border border-border text-left max-w-md mx-auto mt-6"
        >
          <div class="font-bold text-primary mb-1 flex items-center gap-2">
            <lucide-icon [img]="Smartphone" class="w-4 h-4"></lucide-icon>
            {{ 'challenges.giftCatcher.controlsMobile' | translate }}
          </div>
        </div>

        <!-- Game Stats -->
        <div class="mt-6 pt-6 border-t border-border">
          <h3 class="text-lg font-bold text-primary mb-3">Goal</h3>
          <div class="grid grid-cols-2 gap-4">
            <div class="bg-surface p-3 rounded-lg text-center">
              <div class="text-xs text-text-muted uppercase tracking-wider mb-1">Target Score</div>
              <div class="text-xl font-mono font-bold text-gold">
                {{ config.targetScore }}
              </div>
            </div>
            <div class="bg-surface p-3 rounded-lg text-center">
              <div class="text-xs text-text-muted uppercase tracking-wider mb-1">Best Time</div>
              <div class="text-xl font-mono font-bold text-secondary">
                {{ formatTime(bestTime) }}
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </app-challenge-info-modal>

  <div
    class="game-area relative w-full aspect-[3/4] sm:aspect-[4/3] bg-black rounded-lg overflow-hidden mb-4 shadow-2xl border-2 border-primary/30"
  >
    <canvas
      #gameCanvas
      class="w-full h-full touch-none"
      (touchstart)="handleTouchStart($event)"
      (touchend)="handleTouchEnd($event)"
      (touchcancel)="handleTouchEnd($event)"
    ></canvas>

    <!-- HUD -->
    <div class="absolute top-4 left-4 right-4 flex justify-between items-start pointer-events-none">
      <div class="flex flex-col gap-2">
        <div
          class="bg-surface/80 backdrop-blur px-2 py-1 rounded-lg border border-white/10 shadow-sm"
        >
          <div class="text-[10px] text-text-muted uppercase tracking-wider leading-none mb-0.5">
            Score
          </div>
          <div class="text-base sm:text-xl font-bold text-gold font-mono leading-none">
            {{ score }} / {{ config.targetScore }}
          </div>
        </div>

        <div
          class="bg-surface/80 backdrop-blur px-2 py-1 rounded-lg border border-white/10 shadow-sm"
        >
          <div class="text-[10px] text-text-muted uppercase tracking-wider leading-none mb-0.5">
            Time
          </div>
          <div class="text-sm sm:text-lg font-bold text-white font-mono leading-none">
            {{ formatTime(elapsedTime) }}
          </div>
        </div>
      </div>

      @if (bestTime > 0) {
      <div
        class="bg-surface/80 backdrop-blur px-2 py-1 rounded-lg border border-white/10 shadow-sm"
      >
        <div
          class="text-[10px] text-text-muted uppercase tracking-wider text-right leading-none mb-0.5"
        >
          Best
        </div>
        <div class="text-sm sm:text-lg font-bold text-gold font-mono leading-none">
          üèÜ {{ formatTime(bestTime) }}
        </div>
      </div>
      }
    </div>

    <!-- Start Screen -->
    @if (!gameStarted && !gameWon) {
    <div
      class="absolute inset-0 flex items-center justify-center bg-black/60 backdrop-blur-sm z-10"
    >
      <div class="text-center p-4 sm:p-6">
        <div class="text-4xl sm:text-6xl mb-4 animate-bounce">üéÅ</div>
        <button
          (click)="startGame()"
          class="btn btn-primary text-lg sm:text-xl px-6 py-2 sm:px-8 sm:py-3 shadow-lg hover:scale-105 transition-transform"
        >
          {{ 'challenges.giftCatcher.start' | translate }}
        </button>
      </div>
    </div>
    }

    <!-- Win Screen -->
    @if (gameWon) {
    <div
      class="absolute inset-0 flex items-center justify-center bg-accent-green/90 backdrop-blur-sm z-20 animate-fade-in"
    >
      <div
        class="text-center p-4 sm:p-8 bg-surface rounded-2xl shadow-2xl border-2 border-gold max-w-sm mx-4"
      >
        <div class="text-4xl sm:text-6xl mb-2 sm:mb-4">üéÖ</div>
        <h3 class="text-xl sm:text-3xl font-bold text-white mb-2">
          {{ 'challenges.giftCatcher.victory' | translate }}
        </h3>
        <p class="text-white/90 text-sm sm:text-base mb-4 sm:mb-6">
          {{ 'challenges.giftCatcher.successMessage' | translate }}
        </p>
        <div class="flex flex-col gap-2 sm:gap-3">
          <button
            (click)="showReward()"
            class="btn btn-primary w-full font-bold text-base sm:text-lg"
          >
            {{ 'ui.showReward' | translate }}
          </button>
          <button (click)="startGame()" class="btn btn-outline w-full text-sm sm:text-base">
            {{ 'ui.playAgain' | translate }}
          </button>
        </div>
      </div>
    </div>
    }
  </div>

  <!-- Mobile Controls -->
  <div class="flex justify-between w-full mt-4 px-4 lg:hidden z-30">
    <button
      class="btn btn-secondary rounded-full w-16 h-16 flex items-center justify-center opacity-80 active:scale-95 transition-transform touch-none pointer-events-auto shadow-lg border-2 border-white/20"
      (touchstart)="startMove('left'); $event.preventDefault()"
      (touchend)="stopMove('left'); $event.preventDefault()"
      (mousedown)="startMove('left')"
      (mouseup)="stopMove('left')"
      (mouseleave)="stopMove('left')"
    >
      <lucide-icon [img]="ArrowLeft" class="w-8 h-8"></lucide-icon>
    </button>

    <button
      class="btn btn-secondary rounded-full w-16 h-16 flex items-center justify-center opacity-80 active:scale-95 transition-transform touch-none pointer-events-auto shadow-lg border-2 border-white/20"
      (touchstart)="startMove('right'); $event.preventDefault()"
      (touchend)="stopMove('right'); $event.preventDefault()"
      (mousedown)="startMove('right')"
      (mouseup)="stopMove('right')"
      (mouseleave)="stopMove('right')"
    >
      <lucide-icon [img]="ArrowRight" class="w-8 h-8"></lucide-icon>
    </button>
  </div>
</div>
