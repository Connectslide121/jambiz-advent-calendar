<div class="word-search-container">
  <!-- Title -->
  <h3 class="text-xl sm:text-2xl font-bold text-gold mb-6 text-center">
    ðŸŽ„ {{ 'challenges.wordSearch.title' | translate }} ðŸŽ„
  </h3>

  <!-- Instructions -->
  <p class="text-center text-text-muted mb-6">
    {{ 'challenges.wordSearch.instruction' | translate }}
  </p>

  <!-- Words to Find -->
  <div class="bg-bg rounded-lg p-4 mb-6">
    <p class="text-sm text-text-muted mb-2 text-center">
      {{ 'challenges.wordSearch.wordsToFind' | translate }}
    </p>
    <div class="flex flex-wrap gap-2 justify-center">
      @for (word of currentWords; track word) {
      <span
        class="px-3 py-1 rounded-full text-sm font-medium transition-all"
        [class.bg-accent-green]="isWordFound(word)"
        [class.text-white]="isWordFound(word)"
        [class.line-through]="isWordFound(word)"
        [class.bg-surface]="!isWordFound(word)"
        [class.text-text]="!isWordFound(word)"
      >
        {{ word }}
      </span>
      }
    </div>
  </div>

  <!-- Progress -->
  <div class="text-center mb-6">
    <p class="text-text-muted">
      {{
        'challenges.wordSearch.wordsFound'
          | translate : { found: foundWords.length, total: currentWords.length }
      }}
    </p>
  </div>

  <!-- Word Search Grid -->
  <div
    class="flex justify-center mb-6 overflow-x-auto"
    (mouseup)="onMouseUp()"
    (mouseleave)="onMouseUp()"
    (touchend)="onTouchEnd($event)"
    (touchcancel)="onTouchEnd($event)"
  >
    <div class="inline-block select-none touch-none">
      @for (row of currentGrid; track rowIndex; let rowIndex = $index) {
      <div class="flex">
        @for (cell of row; track colIndex; let colIndex = $index) {
        <button
          #gridCell
          [attr.data-row]="rowIndex"
          [attr.data-col]="colIndex"
          class="w-8 h-8 sm:w-10 sm:h-10 md:w-12 md:h-12 flex items-center justify-center border border-gray-600 text-sm sm:text-base md:text-lg font-bold uppercase transition-all touch-manipulation flex-shrink-0"
          [class.bg-accent-green]="isCellInFoundWord(rowIndex, colIndex)"
          [class.text-white]="isCellInFoundWord(rowIndex, colIndex)"
          [class.bg-gold]="
            isCellSelected(rowIndex, colIndex) && !isCellInFoundWord(rowIndex, colIndex)
          "
          [class.text-bg]="
            isCellSelected(rowIndex, colIndex) && !isCellInFoundWord(rowIndex, colIndex)
          "
          [class.bg-surface]="
            !isCellInFoundWord(rowIndex, colIndex) && !isCellSelected(rowIndex, colIndex)
          "
          [class.text-text]="
            !isCellInFoundWord(rowIndex, colIndex) && !isCellSelected(rowIndex, colIndex)
          "
          [class.cursor-pointer]="!isCompleted"
          [class.cursor-default]="isCompleted"
          (mousedown)="onMouseDown(rowIndex, colIndex)"
          (mouseenter)="onMouseEnter(rowIndex, colIndex)"
          (touchstart)="onTouchStart($event, rowIndex, colIndex)"
          (touchmove)="onTouchMove($event)"
        >
          {{ cell }}
        </button>
        }
      </div>
      }
    </div>
  </div>

  <!-- Success Message -->
  @if (allWordsFound) {
  <div class="mb-6 p-4 bg-accent-green bg-opacity-20 border border-accent-green rounded-lg">
    <p class="text-text text-center text-lg font-semibold">
      ðŸŽ‰ðŸŽ„ {{ 'challenges.wordSearch.allFound' | translate }} ðŸŽ„ðŸŽ‰
    </p>
  </div>
  }

  <!-- Show Fun Fact Button (for completed challenges) -->
  @if (isCompleted && allWordsFound) {
  <div class="text-center">
    <button class="btn btn-primary px-8" (click)="showAnswer()">
      {{ 'challenges.wordSearch.showFunFact' | translate }}
    </button>
  </div>
  }
</div>
